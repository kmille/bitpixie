@echo off
setlocal

:: Check if a drive specifying the SMB share is provided
if "%~1"=="" (
	echo	Usage: %~nx0 S:
	exit /b 1
)

:: Remove the trailing backslash if present
set "SERVER=%~1"
if "%SERVER:~-1%"=="\" set "SERVER=%SERVER:~0,-1%"

echo Downloading scripts

copy "%SERVER%\winpe\create-bcd-winpe1.bat" .
copy "%SERVER%\winpe\create-bcd-winpe2.bat" .

echo.
echo Creating first stage BCD
call .\create-bcd-winpe1.bat

echo.
echo Creating second stage BCD
call .\create-bcd-winpe2.bat

echo.
echo Uploading BCDs

copy /Y BCD_winpe1 "%SERVER%"
copy /Y BCD_winpe1 "%SERVER%\BCD"
copy /Y BCD_winpe2 "%SERVER%"

echo.
echo Exit cmd.exe and select PXE boot device
